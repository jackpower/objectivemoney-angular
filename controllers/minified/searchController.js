omApp.controller("searchController",["$scope","$routeParams","$rootScope","$window","$location","searchquery","enquiry","reviews","$http","Data","$timeout","$anchorScroll","$modal","$log",function(a,c,g,h,d,k,n,p,e,f,m,q,r,t){a.searchquery={};a.enquiry={};a.reviews={};a.fname={};a.fname.name="bob";a.searchquery=k;a.enquiry=n;a.reviews=p;a.searchquery.updateTimesSeen=function(){a.searchquery.timesSeen=1};a.open=function(b){a.searchquery.updateTimesSeen();r.open({animation:a.animationsEnabled,templateUrl:"pages/modalWalkthrough.html",
controller:["$scope","$modalInstance","searchquery",function(a,b,c){a.searchquery=c;a.ok=function(){b.close()}}],size:b,resolve:{items:function(){return a.items}}}).result.then(function(b){a.selected=b},function(){t.info("Modal dismissed at: "+new Date)})};a.closeBar=!1;a.setCloseBar=function(){a.closeBar=!0};a.showBar=!1;a.setShowBar=function(){(0<a.searchquery.lat||0>a.searchquery.lat)&&!a.closeBar&&m(function(){a.showBar=!0},3E4);a.closeBar&&(a.showBar=!1)};a.plannerReviews={};e.get("php/getPlannerReviews.php").success(function(b){a.plannerReviews=
b});a.login={};a.doLogin=function(a){f.post("login",{customer:a}).then(function(a){f.toast(a);if("success"==a.status)switch(window.location.hash){case "#/plannerenquiry"+c.id:d.path("/enquire"+c.id);break;case "#/plannerrating"+c.id:d.path("/review"+c.id)}})};a.signup={};a.signup={email:"",password:"",name:""};a.signUp=function(a){f.post("signUp",{customer:a}).then(function(a){f.toast(a);if("success"==a.status)switch(window.location.hash){case "#/plannerenquiry"+c.id:d.path("/enquire"+c.id);break;
case "#/plannerrating"+c.id:d.path("/review"+c.id)}})};a.logout=function(){f.get("logout").then(function(a){f.toast(a);d.path("/search")})};a.changeAuth=function(){g.authenticated=!1};a.enquiry={requirements:"",usergender:"",userage:"",userjob:""};a.postEnquiry=function(){e.post("php/postEnquiry.php",{enquiry:a.enquiry,userid:a.userid,pid:a.pid,user_name:a.name,user_email:a.email}).success(function(a){console.log(a);d.path("/enquirythanks"+c.id)}).error(function(a){console.log(a);d.path("/enquire"+
c.id)})};a.postSearch=function(){e.post("php/postSearch.php",{searchquery:a.searchquery,userid:a.userid,pid:a.pid}).success(function(a){console.log(a)}).error(function(a,l){console.log(a)})};a.customerList={};a.mailingListSubmit=function(){e.post("php/postCustomerMailing.php",{searchquery:a.searchquery,customerList:a.customerList}).success(function(a){console.log(a);d.path("/mailinglistthanks")}).error(function(a,l){console.log(a)})};a.postSearchUnfulfilled=function(){e.post("php/postSearchUnfulfilled.php",
{searchquery:a.searchquery}).success(function(a){console.log(a)}).error(function(a,l){console.log(a)})};a.searchquery.formFilled=!1;a.checkFormCompleteness=function(){m(function(){(0!==a.searchquery.monthlysalary||0!==a.searchquery.lumpsum)&&0<a.searchquery.address.name.length&&(a.searchquery.formFilled=!0)},1E3)};a.reviews={clientgender:"",clientage:"",clientjob:"",score:"",overall:"",services:"",good:"",better:"",postRegex:/(?!.*)/,postcode:""};a.reviews.postRegex="foo";a.postReview=function(){e.post("php/postReview.php",
{reviews:a.reviews,userid:a.userid,pid:a.pid,name:a.name}).success(function(a){console.log(a);d.path("/reviewthanks"+c.id)}).error(function(a,l){console.log(a)})};a.setSearchValueToNull=function(){a.searchquery.investments||(a.searchquery.investments=!1);a.searchquery.LT||(a.searchquery.LT=!1);a.searchquery.ST||(a.searchquery.ST=!1);a.searchquery.TP||(a.searchquery.TP=!1);a.searchquery.EP||(a.searchquery.EP=!1);a.searchquery.MA||(a.searchquery.MA=!1);a.searchquery.english||(a.searchquery.english=
!1);a.searchquery.afrikaans||(a.searchquery.afrikaans=!1);a.searchquery.zulu||(a.searchquery.zulu=!1);a.searchquery.xhosa||(a.searchquery.xhosa=!1);a.searchquery.southernsotho||(a.searchquery.southernsotho=!1);a.searchquery.tswana||(a.searchquery.tswana=!1);a.searchquery.northernsotho||(a.searchquery.northernsotho=!1);a.searchquery.tsonga||(a.searchquery.tsonga=!1);a.searchquery.venda||(a.searchquery.venda=!1);a.searchquery.swati||(a.searchquery.swati=!1);a.searchquery.ndebele||(a.searchquery.ndebele=
!1);if("male"!==a.searchquery.gender||"female"!==a.searchquery.gender)a.searchquery.gender="";"undefined"===typeof a.searchquery.monthlysalary&&(a.searchquery.monthlysalary=0);"undefined"===typeof a.searchquery.lumpsum&&(a.searchquery.lumpsum=0);"undefined"===typeof a.searchquery.clientvalue&&(a.searchquery.clientvalue=0)};a.setSearchValueToNull();a.plannerprofiles=[];e.get("php/getPlannerProfiles.php").then(function(b){a.plannerprofiles=b.data;a.plannersFilterd=[];a.plannerprofiles.currentPage=1;
a.plannerprofiles.itemsPerPage=4;a.plannerprofiles.maxSize=5;a.plannerprofiles.setPage=function(b){a.plannerprofiles.currentPage=b};a.setPageNameChange=function(){a.searchquery.querybol&&a.plannerprofiles.setPage(1)};a.plannerprofiles.pageChanged=function(){q("navbar-example")};a.options={componentRestrictions:{country:"ZA"}};a.client1year=function(b,c){return isNaN(b)&&isNaN(c)?a.searchquery.clientvalue=0:isNaN(b)?a.searchquery.clientvalue=c:isNaN(c)?a.searchquery.clientvalue=12*b*.15:a.searchquery.clientvalue=
12*b*.15+c};a.plannerprofiles.transformName=function(){for(i=0;i<a.plannerprofiles.length;i++)a.plannerprofiles[i].plannerfullname=a.plannerprofiles[i].plannerfirstname+" "+a.plannerprofiles[i].plannersurname};a.plannerprofiles.transformName();a.plannerprofiles.transformState=function(){for(i=0;i<a.plannerprofiles.length;i++)"GP"===a.plannerprofiles[i].addressState?a.plannerprofiles[i].addressState="Gauteng":"EC"===a.plannerprofiles[i].addressState?a.plannerprofiles[i].addressState="Eastern Cape":
"FS"===a.plannerprofiles[i].addressState?a.plannerprofiles[i].addressState="Free State":"KZN"===a.plannerprofiles[i].addressState?a.plannerprofiles[i].addressState="KwaZulu-Natal":"LP"===a.plannerprofiles[i].addressState?a.plannerprofiles[i].addressState="Limpopo":"MP"===a.plannerprofiles[i].addressState?a.plannerprofiles[i].addressState="Mpumalanga":"NC"===a.plannerprofiles[i].addressState?a.plannerprofiles[i].addressState="Northern Cape":"NW"===a.plannerprofiles[i].addressState&&(a.plannerprofiles[i].addressState=
"North West")};a.plannerprofiles.transformState();a.plannerprofiles.transformIndependence=function(){for(i=0;i<a.plannerprofiles.length;i++)a.plannerprofiles[i].independent="1"===a.plannerprofiles[i].independent?"Independent":"Not Independent"};a.plannerprofiles.transformIndependence();a.plannerprofiles.transformExp=function(){for(i=0;i<a.plannerprofiles.length;i++)a.plannerprofiles[i].yearsExperienceTrans=Math.floor(a.plannerprofiles[i].yearsExperience/12),a.plannerprofiles[i].yearsExperienceTrans=
0===a.plannerprofiles[i].yearsExperienceTrans?a.plannerprofiles[i].yearsExperience+" months":1===a.plannerprofiles[i].yearsExperienceTrans?a.plannerprofiles[i].yearsExperienceTrans+" year":a.plannerprofiles[i].yearsExperienceTrans+" years"};a.plannerprofiles.transformExp();a.plannerprofiles.transformAge=function(){for(i=0;i<a.plannerprofiles.length;i++)a.plannerprofiles[i].yearsTrans=Math.floor(a.plannerprofiles[i].plannerage)};a.plannerprofiles.transformAge();a.plannerprofiles.clientDistance=function(){for(i=
0;i<a.plannerprofiles.length;i++){var b=a.plannerprofiles[i].addressLat,c=a.searchquery.lat,d=(c-b)*Math.PI/180,e=(a.searchquery["long"]-a.plannerprofiles[i].addressLong)*Math.PI/180,b=Math.sin(d/2)*Math.sin(d/2)+Math.cos(b*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(e/2)*Math.sin(e/2),b=2*Math.asin(Math.sqrt(b));a.plannerprofiles[i].distancetoclient=Math.round(6371*b)}};a.plannerprofiles.clientDistance();a.scorereview=5;a.scoreCFP=1;a.scoreAFP=.75;a.scoreRFP=1;a.scoreFSA=.25;a.serviceratingInHouse=
1;a.serviceratingOutsource=.5;a.scorelanguages=1;a.scoregender=1;a.plannerprofiles.relevanceScore=function(){for(i=0;i<a.plannerprofiles.length;i++)a.plannerprofiles[i].relevance=0;for(i=0;i<a.plannerprofiles.length;i++)a.searchquery.gender===a.plannerprofiles[i].plannergender?a.plannerprofiles[i].relevance+=a.scoregender:a.searchquery.gender!==a.plannerprofiles[i].plannergender&&(a.plannerprofiles[i].relevance+=0);for(i=0;i<a.plannerprofiles.length;i++)"1"===a.plannerprofiles[i].verified?a.plannerprofiles[i].relevance+=
10:"0"===a.plannerprofiles[i].verified&&(a.plannerprofiles[i].relevance-=10);for(i=0;i<a.plannerprofiles.length;i++)"1"===a.plannerprofiles[i].CFP?a.plannerprofiles[i].relevance+=a.scoreCFP:"1"===a.plannerprofiles[i].AFP?a.plannerprofiles[i].relevance+=a.scoreAFP:"1"===a.plannerprofiles[i].RFP?a.plannerprofiles[i].relevance+=a.scoreRFP:"1"===a.plannerprofiles[i].FSA?a.plannerprofiles[i].relevance+=a.scoreFSA:"1"===a.plannerprofiles[i].undisclosed&&(a.plannerprofiles[i].relevance+=0);for(i=0;i<a.plannerprofiles.length;i++)!0===
a.searchquery.investments&&"inHouse"===a.plannerprofiles[i].investments?a.plannerprofiles[i].relevance+=a.serviceratingInHouse:!0===a.searchquery.investments&&"outsource"===a.plannerprofiles[i].investments&&(a.plannerprofiles[i].relevance+=a.serviceratingOutsource);for(i=0;i<a.plannerprofiles.length;i++)!0===a.searchquery.LT&&"inHouse"===a.plannerprofiles[i].LT?a.plannerprofiles[i].relevance+=a.serviceratingInHouse:!0===a.searchquery.LT&&"outsource"===a.plannerprofiles[i].LT&&(a.plannerprofiles[i].relevance+=
a.serviceratingOutsource);for(i=0;i<a.plannerprofiles.length;i++)!0===a.searchquery.ST&&"inHouse"===a.plannerprofiles[i].ST?a.plannerprofiles[i].relevance+=a.serviceratingInHouse:!0===a.searchquery.ST&&"outsource"===a.plannerprofiles[i].ST&&(a.plannerprofiles[i].relevance+=a.serviceratingOutsource);for(i=0;i<a.plannerprofiles.length;i++)!0===a.searchquery.EP&&"inHouse"===a.plannerprofiles[i].EP?a.plannerprofiles[i].relevance+=a.serviceratingInHouse:!0===a.searchquery.EP&&"outsource"===a.plannerprofiles[i].EP&&
(a.plannerprofiles[i].relevance+=a.serviceratingOutsource);for(i=0;i<a.plannerprofiles.length;i++)!0===a.searchquery.TP&&"inHouse"===a.plannerprofiles[i].TP?a.plannerprofiles[i].relevance+=a.serviceratingInHouse:!0===a.searchquery.TP&&"outsource"===a.plannerprofiles[i].TP&&(a.plannerprofiles[i].relevance+=a.serviceratingOutsource);for(i=0;i<a.plannerprofiles.length;i++)!0===a.searchquery.MA&&"inHouse"===a.plannerprofiles[i].MA?a.plannerprofiles[i].relevance+=a.serviceratingInHouse:!0===a.searchquery.MA&&
"outsource"===a.plannerprofiles[i].MA&&(a.plannerprofiles[i].relevance+=a.serviceratingOutsource);for(i=0;i<a.plannerprofiles.length;i++)a.plannerprofiles[i].relevance=""===a.plannerprofiles[i].average_rating?a.plannerprofiles[i].relevance+0:a.plannerprofiles[i].relevance+parseFloat(a.plannerprofiles[i].average_rating)};a.getreqlanguageScore=function(){a.searchquery.reqlanguagescore=a.searchquery.english||a.searchquery.afrikaans||a.searchquery.zulu||a.searchquery.xhosa||a.searchquery.southernsotho||
a.searchquery.tswana||a.searchquery.northernsotho||a.searchquery.tsonga||a.searchquery.venda||a.searchquery.swati||a.searchquery.ndebele?1:0};a.plannerprofiles.getlanguageScore=function(){for(i=0;i<a.plannerprofiles.length;i++)a.plannerprofiles[i].languagescore=!0===a.searchquery.english&&"1"===a.plannerprofiles[i].english?1:!0===a.searchquery.afrikaans&&"1"===a.plannerprofiles[i].afrikaans?1:!0===a.searchquery.zulu&&"1"===a.plannerprofiles[i].zulu?1:!0===a.searchquery.xhosa&&"1"===a.plannerprofiles[i].xhosa?
1:!0===a.searchquery.southernsotho&&"1"===a.plannerprofiles[i].southernsotho?1:!0===a.searchquery.tswana&&"1"===a.plannerprofiles[i].tswana?1:!0===a.searchquery.northernsotho&&"1"===a.plannerprofiles[i].northernsotho?1:!0===a.searchquery.tsonga&&"1"===a.plannerprofiles[i].tsonga?1:!0===a.searchquery.venda&&"1"===a.plannerprofiles[i].venda?1:!0===a.searchquery.swati&&"1"===a.plannerprofiles[i].swati?1:!0===a.searchquery.ndebele&&"1"===a.plannerprofiles[i].ndebele?1:0};a.getreqlanguagecompara=function(){for(i=
0;i<a.plannerprofiles.length;i++)a.plannerprofiles[i].reqlanguagecompara=a.plannerprofiles[i].languagescore>=a.searchquery.reqlanguagescore?1:0};a.getreqserviceScore=function(){a.searchquery.reqservicescore=0;a.searchquery.reqservicescore=a.searchquery.investments?a.searchquery.reqservicescore+1:a.searchquery.reqservicescore+0;a.searchquery.reqservicescore=a.searchquery.LT?a.searchquery.reqservicescore+1:a.searchquery.reqservicescore+0;a.searchquery.reqservicescore=a.searchquery.ST?a.searchquery.reqservicescore+
1:a.searchquery.reqservicescore+0;a.searchquery.reqservicescore=a.searchquery.EP?a.searchquery.reqservicescore+1:a.searchquery.reqservicescore+0;a.searchquery.reqservicescore=a.searchquery.TP?a.searchquery.reqservicescore+1:a.searchquery.reqservicescore+0;a.searchquery.reqservicescore=a.searchquery.MA?a.searchquery.reqservicescore+1:a.searchquery.reqservicescore+0};a.plannerprofiles.getserviceScore=function(){for(i=0;i<a.plannerprofiles.length;i++)a.plannerprofiles[i].servicescore=0;for(i=0;i<a.plannerprofiles.length;i++)!0===
a.searchquery.investments&&"notOffered"!==a.plannerprofiles[i].investments&&(a.plannerprofiles[i].servicescore+=1);for(i=0;i<a.plannerprofiles.length;i++)!0===a.searchquery.LT&&"notOffered"!==a.plannerprofiles[i].LT&&(a.plannerprofiles[i].servicescore+=1);for(i=0;i<a.plannerprofiles.length;i++)!0===a.searchquery.ST&&"notOffered"!==a.plannerprofiles[i].ST&&(a.plannerprofiles[i].servicescore+=1);for(i=0;i<a.plannerprofiles.length;i++)!0===a.searchquery.EP&&"notOffered"!==a.plannerprofiles[i].EP&&(a.plannerprofiles[i].servicescore+=
1);for(i=0;i<a.plannerprofiles.length;i++)!0===a.searchquery.TP&&"notOffered"!==a.plannerprofiles[i].TP&&(a.plannerprofiles[i].servicescore+=1);for(i=0;i<a.plannerprofiles.length;i++)!0===a.searchquery.MA&&"notOffered"!==a.plannerprofiles[i].MA&&(a.plannerprofiles[i].servicescore+=1)};a.getreqservicecompara=function(){for(i=0;i<a.plannerprofiles.length;i++)a.plannerprofiles[i].reqservicecompara=a.plannerprofiles[i].servicescore>=a.searchquery.reqservicescore?1:0};a.getPlannerfilter=function(){for(i=
0;i<a.plannerprofiles.length;i++)a.plannerprofiles[i].plannerfilter=a.searchquery.clientvalue>=a.plannerprofiles[i].clientMinimum&&a.plannerprofiles[i].distancetoclient<a.plannerprofiles[i].travelWilling&&1===a.plannerprofiles[i].reqlanguagecompara&&1===a.plannerprofiles[i].reqservicecompara?!0:!1};a.searchquery.query="";a.searchquery.querybol=!1;a.getQuerylen=function(){a.searchquery.querylen=a.searchquery.query.length;a.searchquery.querybol=0===a.searchquery.querylen?!1:!0};a.$watchGroup("searchquery.gender searchquery.investments searchquery.LT searchquery.ST searchquery.TP searchquery.EP searchquery.MA searchquery.english searchquery.afrikaans searchquery.zulu searchquery.xhosa searchquery.southernsotho searchquery.tswana searchquery.northernsotho searchquery.tsonga searchquery.venda searchquery.swati searchquery.ndebele searchquery.address.name searchquery.monthlysalary searchquery.lumpsum searchquery.query".split(" "),
function(){a.client1year(k.monthlysalary,k.lumpsum);a.getreqlanguageScore();a.plannerprofiles.getlanguageScore();a.getreqlanguagecompara();a.getreqserviceScore();a.plannerprofiles.getserviceScore();a.getreqservicecompara();a.plannerprofiles.relevanceScore();a.plannerprofiles.clientDistance();a.getPlannerfilter();a.getQuerylen();a.setPageNameChange();a.checkFormCompleteness();a.setShowBar()});a.pid=c.id;a.plannerprofiles.pid=c.id});a.sidebarOpen=!1;a.toggle=function(){a.sidebarOpen=!a.sidebarOpen};
a.fullReviewOpen=!1;a.toggleReview=function(){a.fullReviewOpen=!a.fullReviewOpen};a.$watch(function(){return h.innerWidth},function(b){a.searchquery.windowWidth=b});a.isCollapsed=!0;a.maxchar=1E3;a.$watch("enquiry.requirements",function(b,c){b&&(b.length>a.maxchar&&(a.enquiry.requirements=c),a.enquiry.wordsleft=a.maxchar-b.length)});a.$watch("reviews.overall",function(b,c){b&&(b.length>a.maxchar&&(a.reviews.overall=c),a.reviews.overallwordsleft=a.maxchar-b.length)});a.$watch("reviews.services",function(b,
c){b&&(b.length>a.maxchar&&(a.reviews.services=c),a.reviews.serviceswordsleft=a.maxchar-b.length)});a.$watch("reviews.good",function(b,c){b&&(b.length>a.maxchar&&(a.reviews.good=c),a.reviews.goodwordsleft=a.maxchar-b.length)});a.$watch("reviews.better",function(b,c){b&&(b.length>a.maxchar&&(a.reviews.better=c),a.reviews.betterwordsleft=a.maxchar-b.length)});a.rate=0;a.max=5;a.isReadonly=!1;a.hoveringOver=function(b){a.overStar=b};a.plannerprofiles.rate=0;a.plannerprofiles.max=5;a.plannerprofiles.isReadonly=
!1;a.plannerprofiles.hoveringOver=function(b){a.plannerprofiles.overStar=b};a.loadShareThis=function(){stButtons.makeButtons()};a.myInterval=1500;a.slides=[{image:"psg_logo"},{image:"liberty_logo"},{image:"oldMutual_logo"},{image:"investec_logo"},{image:"hollard_logo"},{image:"discovery_logo"},{image:"sanlam_logo"},{image:"stanlib_logo"}]}]);
omApp.directive("plannerProfileSearch",function(){return{restrict:"EC",templateUrl:"directives/plannerprofilesearch.html",replace:!0,scope:{plannerData:"=",searchData:"=",clientValue:"&",postSearchUnfulfilled:"&"}}});omApp.directive("searchSidebarLarge",function(){return{restrict:"EC",templateUrl:"directives/searchsidebarlarge.html",replace:!0,scope:{searchData:"=",toggle:"&",sidebarOpen:"=",plannerData:"="}}});
omApp.directive("searchSidebarSmall",function(){return{restrict:"EC",templateUrl:"directives/searchsidebarsmall.html",replace:!0,scope:{searchData:"=",toggle:"&",sidebarOpen:"=",plannerData:"="}}});omApp.directive("disableAnimation",["$animate",function(a){return{restrict:"A",link:function(c,g,h){h.$observe("disableAnimation",function(c){a.enabled(!c,g)})}}}]);