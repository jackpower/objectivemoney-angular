/*global module:false, require:false */
/*
 * grunt-rev-package
 * https://github.com/pajtai/grunt-rev-package
 *
 * Copyright (c) 2012 Peter Ajtai
 * Licensed under the MIT license.
 */
module.exports = function (grunt) {
    'use strict';

    var fs = require('fs'),
        path = require('path');

    // rev task - suggested use is in a temp directory
    grunt.registerMultiTask('revPackage', 'Automate the renaming of files to include the package.json revision',
        function () {
            var files = this.data;

            grunt.file.expand(files).forEach(function (oneFile) {
                var pkg = grunt.file.readJSON('package.json'),
                    ver = pkg.version,
                    ext = path.extname(oneFile),
                    renamed = [path.basename(oneFile, ext), ver, ext.slice(1)].join('.');

                grunt.log.writeln(ext);
                // create the new file
                fs.renameSync(oneFile, path.resolve(path.dirname(oneFile), renamed));
                grunt.log.write(oneFile + ' ').ok(renamed);
            });
        });
};
